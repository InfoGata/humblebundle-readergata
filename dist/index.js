(()=>{const e=async e=>{const a=["pdf","epub"],t=`https://www.humblebundle.com/api/v1/order/${e}?ajax=true`,o=await application.networkRequest(t);return(await o.json()).subproducts.filter((e=>e.downloads.some((e=>"ebook"===e.platform)))).map((e=>({title:e.human_name,images:[{url:e.icon}],sources:e.downloads[0].download_struct.map((e=>({name:e.name,source:e.url.web,type:"pdf"===e.name.toLocaleLowerCase()?"application/pdf":"application/epub+zip"}))).filter((e=>a.includes(e.name?.toLocaleLowerCase()||"")))})))},a=()=>{const e=localStorage.getItem("simpleAuth")||"";var a;a={type:"info",simpleAuth:e},application.postUiMessage(a)},t=async a=>({type:"publication",items:await(async()=>{const a=await application.networkRequest("https://www.humblebundle.com/api/v1/user/order?ajax=true");if(200!==a.status)return[];const t=await a.json();let o=[];for(const a of t)o.push(e(a.gamekey));return(await Promise.all(o)).flat()})()});application.onUiMessage=async e=>{switch(e.type){case"check-login":a();break;case"save":e.simpleAuth&&(application.onGetFeed=t),localStorage.setItem("simpleAuth",e.simpleAuth),application.createNotification({message:"Save successful"});break;default:}};const o=e=>new Promise(((a,t)=>{const o=new FileReader;o.onload=e=>{a(e.target?.result)},o.onerror=e=>t(e),o.readAsBinaryString(e)}));application.onGetFeed=t,application.onGetPublication=async e=>{const a=await application.networkRequest(e.source),t=await a.blob();return{data:await o(t)}}})();