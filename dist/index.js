(()=>{const e=e=>{const a={Cookie:`_simpleauth_sess=${localStorage.getItem("simpleAuth")};`};return`https://cloudcors.audio-pwa.workers.dev?setRequestHeaders=${JSON.stringify(a)}&url=${e}`},a=async a=>{const t=["pdf","epub"],o=`https://www.humblebundle.com/api/v1/order/${a}?ajax=true`,s=await fetch(e(o));return(await s.json()).subproducts.filter((e=>e.downloads.some((e=>"ebook"===e.platform)))).map((e=>({title:e.human_name,images:[{url:e.icon}],sources:e.downloads[0].download_struct.map((e=>({name:e.name,source:e.url.web,type:"pdf"===e.name.toLocaleLowerCase()?"application/pdf":"application/epub+zip"}))).filter((e=>t.includes(e.name?.toLocaleLowerCase()||"")))})))},t=async()=>{const e=localStorage.getItem("simpleAuth")||"";var a;a={type:"info",extensionedInstalled:await application.isNetworkRequestCorsDisabled(),simpleAuth:e},application.postUiMessage(a)},o=async t=>({type:"publication",items:await(async()=>{const t=await fetch(e("https://www.humblebundle.com/api/v1/user/order?ajax=true"));if(200!==t.status)return[];const o=await t.json();let s=[];for(const e of o)s.push(a(e.gamekey));return(await Promise.all(s)).flat()})()});application.onUiMessage=async e=>{switch(e.type){case"check-login":t();break;case"save":e.simpleAuth&&(application.onGetFeed=o),localStorage.setItem("simpleAuth",e.simpleAuth),application.createNotification({message:"Save successful"});break;default:}};const s=e=>new Promise(((a,t)=>{const o=new FileReader;o.onload=e=>{a(e.target?.result)},o.onerror=e=>t(e),o.readAsBinaryString(e)}));application.onGetPublication=async e=>{const a=await application.networkRequest(e.source),t=await a.blob();return{source:await s(t),sourceType:"binary"}};localStorage.getItem("simpleAuth")&&(application.onGetFeed=o)})();