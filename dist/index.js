(()=>{const e="https://www.humblebundle.com/api/v1/user/order?ajax=true",a=e=>{const a={Cookie:`_simpleauth_sess=${localStorage.getItem("simpleAuth")};`};return`https://cloudcors.audio-pwa.workers.dev?setRequestHeaders=${JSON.stringify(a)}&url=${e}`},t=async e=>{const t=["pdf","epub"],o=`https://www.humblebundle.com/api/v1/order/${e}?ajax=true`,i=await application.isLoggedIn()?await application.networkRequest(o):await fetch(a(o));return(await i.json()).subproducts.filter((e=>e.downloads.some((e=>"ebook"===e.platform)))).map((e=>({title:e.human_name,images:[{url:e.icon}],sources:e.downloads[0].download_struct.map((e=>({name:e.name,source:e.url.web,type:"pdf"===e.name.toLocaleLowerCase()?"application/pdf":"application/epub+zip"}))).filter((e=>t.includes(e.name?.toLocaleLowerCase()||"")))})))},o=async()=>{const e=localStorage.getItem("simpleAuth")||"";var a;a={type:"info",extensionedInstalled:await application.isNetworkRequestCorsDisabled(),simpleAuth:e},application.postUiMessage(a)},i=async o=>({type:"publication",items:await(async()=>{const o=await application.isLoggedIn()?await application.networkRequest(e):await fetch(a(e));if(200!==o.status)return[];const i=await o.json();let s=[];for(const e of i)s.push(t(e.gamekey));return(await Promise.all(s)).flat()})()});application.onUiMessage=async e=>{switch(e.type){case"check-login":o();break;case"save":e.simpleAuth&&(application.onGetFeed=i),localStorage.setItem("simpleAuth",e.simpleAuth),application.createNotification({message:"Save successful"});break;default:}};const s=e=>new Promise(((a,t)=>{const o=new FileReader;o.onload=e=>{a(e.target?.result)},o.onerror=e=>t(e),o.readAsBinaryString(e)}));application.onGetPublication=async e=>{const a=await application.networkRequest(e.source),t=await a.blob();return{source:await s(t),sourceType:"binary"}};const n=e=>{localStorage.setItem("kb-color-mode",e)};application.onChangeTheme=async e=>{n(e)};const c=async()=>{const e=localStorage.getItem("simpleAuth"),a=await application.isLoggedIn();console.log("logged In:",a),(e||a)&&(application.onGetFeed=i);const t=await application.getTheme();n(t)};application.onPostLogin=c,c()})();